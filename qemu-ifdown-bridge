#!/bin/sh

ip link set $1 nomaster

if is_bridge_interface $BRIDGE; then
  t1=$(ip link show $ETHERNET)
  t2=$(ip link show master $BRIDGE)
  if [[ "$t1" = "$t2" ]]; then
    IP=$(ip -4 addr show $BRIDGE | grep " inet " | awk '{print $2}')
    GATEWAY=$(ip -4 route list 0/0 dev $BRIDGE | cut -d\  -f3)

    ip link set $ETHERNET nomaster
    ip link del $BRIDGE

    [[ -n "$IP" ]] && ip addr add $IP dev $ETHERNET
    [[ -n "$GATEWAY" ]] && ip route add default via $GATEWAY dev $ETHERNET
  fi
fi
