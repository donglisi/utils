#!/bin/sh

BRIDGE=br1

IP=$(ip -4 addr show $ETHERNET | grep " inet " | awk '{print $2}')
[[ $(echo $IP) =~ " " ]] && echo There are multiple ip, Unable to process && exit 1

GATEWAY=$(ip -4 route show 0.0.0.0/0 dev $ETHERNET | cut -d\  -f3)
[[ $(echo $GATEWAY) =~ " " ]] && echo There are multiple default route, Unable to process && exit 2

if ! is_bridge_interface $BRIDGE; then
  ip link add $BRIDGE type bridge
  ip link set $ETHERNET master $BRIDGE
  ip link set $BRIDGE up
  ip addr del $IP dev $ETHERNET
  ip addr add $IP dev $BRIDGE
  [[ -n "GATEWAY" ]] && ip route add default via $GATEWAY dev $BRIDGE
fi

ip link set $1 master $BRIDGE
ip link set $1 up
